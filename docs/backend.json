{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the GanhaFlow Invest platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "accountStatus": {
          "type": "string",
          "description": "Status of the user's account (e.g., Active, Inactive)."
        },
        "availableBalance": {
          "type": "number",
          "description": "The user's available balance for investments."
        }
      },
      "required": [
        "id",
        "email",
        "accountStatus",
        "availableBalance"
      ]
    },
    "InvestmentMachine": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InvestmentMachine",
      "type": "object",
      "description": "Represents an investment machine available on the platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the investment machine."
        },
        "name": {
          "type": "string",
          "description": "Name of the investment machine (e.g., Bronze, Silver, Gold)."
        },
        "investmentAmount": {
          "type": "number",
          "description": "The amount required to invest in this machine."
        },
        "returnAmount": {
          "type": "number",
          "description": "The amount returned after the investment cycle."
        },
        "cycleDurationDays": {
          "type": "number",
          "description": "The duration of the investment cycle in days."
        }
      },
      "required": [
        "id",
        "name",
        "investmentAmount",
        "returnAmount",
        "cycleDurationDays"
      ]
    },
    "UserInvestment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserInvestment",
      "type": "object",
      "description": "Represents a user's investment in a specific machine.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user investment."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N UserInvestment)"
        },
        "investmentMachineId": {
          "type": "string",
          "description": "Reference to InvestmentMachine. (Relationship: InvestmentMachine 1:N UserInvestment)"
        },
        "investmentDate": {
          "type": "string",
          "description": "The date when the investment was made.",
          "format": "date-time"
        },
        "returnDate": {
          "type": "string",
          "description": "The date when the investment is expected to return.",
          "format": "date-time"
        },
        "returned": {
          "type": "boolean",
          "description": "Indicates whether the investment has returned the funds."
        }
      },
      "required": [
        "id",
        "userId",
        "investmentMachineId",
        "investmentDate",
        "returnDate",
        "returned"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a deposit or withdrawal transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Transaction)"
        },
        "transactionType": {
          "type": "string",
          "description": "Type of transaction (e.g., Deposit, Withdrawal)."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction."
        },
        "transactionDate": {
          "type": "string",
          "description": "The date and time of the transaction.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "transactionType",
        "amount",
        "transactionDate"
      ]
    },
    "Token": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Token",
      "type": "object",
      "description": "Represents a token granted to a user, which can be used for specific actions.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the token."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Token)"
        },
        "tokenValue": {
          "type": "string",
          "description": "The actual token value."
        },
        "expirationDate": {
          "type": "string",
          "description": "The date and time when the token expires.",
          "format": "date-time"
        },
        "used": {
          "type": "boolean",
          "description": "Indicates whether the token has been used."
        }
      },
      "required": [
        "id",
        "userId",
        "tokenValue",
        "expirationDate",
        "used"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Account status and available balance are stored here.  Path-based ownership enforced via the `userId` parameter.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/investmentMachines/{investmentMachineId}",
        "definition": {
          "entityName": "InvestmentMachine",
          "schema": {
            "$ref": "#/backend/entities/InvestmentMachine"
          },
          "description": "Stores information about available investment machines on the platform.",
          "params": [
            {
              "name": "investmentMachineId",
              "description": "The unique identifier for the investment machine."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/investments/{userInvestmentId}",
        "definition": {
          "entityName": "UserInvestment",
          "schema": {
            "$ref": "#/backend/entities/UserInvestment"
          },
          "description": "Stores information about a user's investment in a specific machine. Path-based ownership enforced via the `userId` parameter.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "userInvestmentId",
              "description": "The unique identifier for the user investment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores transaction history for a user (deposits and withdrawals). Path-based ownership enforced via the `userId` parameter.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier for the transaction."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/tokens/{tokenId}",
        "definition": {
          "entityName": "Token",
          "schema": {
            "$ref": "#/backend/entities/Token"
          },
          "description": "Stores tokens generated for the user for specific actions. Path-based ownership enforced via the `userId` parameter.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "tokenId",
              "description": "The unique identifier for the token."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure security, scalability, and ease of debugging, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs.  It leverages structural segregation to maintain a homogeneous security posture within each collection. Authorization independence is achieved through path-based ownership where applicable, and denormalization of membership maps when necessary.\n\nUsers are stored in a top-level `/users` collection for easy management.  `InvestmentMachine` data is stored in a top-level `/investmentMachines` collection, assuming that these are globally available for all users. User-specific data like `UserInvestment` and `Transaction` are stored as subcollections under each user's document (`/users/{userId}/investments`, `/users/{userId}/transactions`), enforcing clear ownership and simplifying security rules.  `Token` data is stored in `/users/{userId}/tokens`. This path-based ownership enforces that only the user can read/write their tokens. \n\nThis structure supports QAPs by ensuring that listing operations are inherently secure due to path-based ownership. Security rules can easily restrict access based on the `request.auth.uid` without relying on complex filtering logic within the rules themselves."
  }
}